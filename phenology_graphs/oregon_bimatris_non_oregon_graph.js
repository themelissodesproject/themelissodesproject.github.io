// ======================================================
// Melissodes + Other Phenology Graph
// ======================================================

const BimatrisOregonGraph = (() => {

    // ==========================
    // Paste ONLY the date columns here
    // ==========================
    const melissodesDates = `
1961-08-16
1959-09-06
1959-09-07
1959-09-06
1959-09-06


1961-09-20
1953-09-17



`;

    const otherDates = `
1938-10-12
1938-10-12
















































































































































































































































































































1963-08-05
1965-09-21
1965-10-03
1965-10-03
1960-09-30
1980-09-16
1980-09-16
1980-09-16
1961-08-16
1959-09-06
1959-09-07
1959-09-06
1959-09-06
1951-08-29
1950-08-24
1950-08-29
1950-08-29
1950-08-24
1950-08-29
1981-08-21
1966-09-21
1966-09-21
1966-09-15
1965-07-08
1980-09-20
1965-09-07
1965-09-07
1965-09-07
1965-09-07
1965-09-07
1965-09-07
1965-09-03
1965-09-03
1965-09-03
1965-09-07
1965-09-03
1965-09-03
1965-09-03
1965-09-03
1965-09-03
1965-09-03
1965-09-03
1981-09-04
1981-09-04
1981-09-04
1981-06-10
1981-08-24
1981-08-24
1980-09-21
1980-06-28
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1979-09-16
1983-09-13
1983-09-13
1983-09-13
1983-09-14
1983-09-13
1983-09-13
1983-09-13
1983-09-13
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-09-23
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1982-10-06
1983-09-13
1983-09-13
1979-09-15
1982-10-05
1982-10-05
1982-10-05
1982-10-05
1982-10-05
1982-10-05
1982-10-05
1984-10-03
1984-10-03
1984-10-03
1984-10-03
1984-10-03
1981-10-03
1981-10-03
1958-09-24
1981-09-01
1981-09-15

































































1959-10-02
1930-09-04
1942-10-05
1942-10-05
1949-08-26
1947-09-03
1951-08-26
1948-08-23
1949-08-26
1949-08-26
1949-08-26
1949-08-26
1949-08-26
1931-08-21
1949-08-26
1942-08-31
1942-08-31
1970-09-01
1972-08-24
1972-09-18
1972-09-07
1972-09-07
1972-08-11
1969-08-26
1972-09-14
1969-08-26
1972-09-14
1972-09-14
1972-09-18
1972-08-11
1940-05-24
1981-09-15
1979-09-15
1972-10-02
1938-09-09














































1980-09-15
1988-10-17



1980-09-16


1940-09-06
1966-09-24
1962-08-10
1962-08-10
1965-08-25
1916-05-17
1946-09-19
1946-09-14
1961-08-26
1952-10-11
1946-09-22
1961-08-26
1959-08-26
1946-09-10
1957-09-08
1961-08-10
1957-09-02
1961-08-23
1961-08-26
1934-10-28

1957-09-06
1951-09-22
1961-08-26
1957-09-02
1957-09-08
1946-09-22
1956-09-11
1946-10-07
1915-08-23
1934-10-28
1938-09-15
1946-10-07
1946-09-23
1961-08-26
1952-10-12
1946-09-16
1959-08-26
1946-09-09
1955-08-30
1950-09-11
1946-09-07
1969-08-20
1942-10-12
1946-09-19
1946-09-19
2013-09-29

2013-09-29
2002-10-07
2002-10-07
2014-10-13
2014-10-13
1953-09-26
1903-09-26
1903-09-16
2024-09-14
2024-09-14
2024-09-14
2024-09-23
2024-09-14
2024-09-14
2024-08-16
2024-08-16
2024-09-14
2024-09-14
2024-09-14
2024-09-14
2024-09-15
2024-09-13
2024-09-13
2024-09-13
2024-09-14
2024-09-10
2024-09-10
2024-09-10
2024-09-10
2023-10-06
2023-10-07
2023-10-07
1920-09-04
2023-09-21
2023-09-21
2024-07-27
2023-09-02
2023-09-02
2023-09-06
2023-09-06
2023-09-06
2024-08-29
2024-08-29
2024-08-29
2024-08-29
2024-09-01
2024-09-04
2024-10-06














































1954-10-02
1955-11-05
1955-11-05
1956-09-24
1955-11-05
1955-11-05
1955-11-05
1955-06-01
1960-08-24
1983-09-05

1957-09-14
1962-08-10
1969-08-29
1944-09-10
1969-09-11
1961-09-20
1961-09-29
1948-08-06
1955-09-19
1961-08-24
1965-09-03

1964-09-04
1962-08-23
1965-09-07
1955-09-18
1957-09-02


1964-09-07
1966-08-25
1965-09-07

1966-09-05
1953-09-17
1957-08-29
1962-10-07
1957-09-07
1932-10-29
1964-09-05

1960-09-08
1969-08-20
1961-08-23
1959-09-09



1966-09-20
1965-09-03
1969-09-26
1957-09-08
1956-09-14


1966-09-24
2001-09-12
2002-10-01
2002-10-01
2002-10-01
2002-10-01
2002-10-01
2002-10-10
2002-10-10
2002-10-10
2002-10-10
2001-08-28
2001-08-28
2001-08-28
2003-08-15
2001-09-17
2003-09-25
2003-09-25
2001-09-10
2003-08-29
2001-09-11
2003-08-29
2001-09-12
2001-09-12
2001-09-12
2003-09-23
2003-09-23
2003-09-23
2003-09-23
2003-09-23
2003-09-23
2003-09-23
2003-08-12
2003-08-20
2003-09-02
2003-09-02
2003-09-02
2003-09-02
2003-09-03
2003-08-20
2003-08-12
2003-09-05
2002-09-26
2002-09-26
2002-09-26
2002-08-30
2002-08-30
2001-09-05
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2001-10-08
2003-09-01
2003-09-01
2003-09-03
2001-09-04
2001-09-04
2001-09-04
2001-09-04
2001-09-04
2003-09-03
2003-09-03
2003-08-22
2001-09-11
2002-09-30
2001-09-17
2002-10-01
2002-10-01
2002-10-01
2002-09-27
2003-08-19
2003-08-19
2003-08-22
2003-08-12
2003-08-12
2003-08-19
2003-08-19
2003-08-19
2001-08-27
2002-08-28
2001-09-18
2000-08-10
2000-08-10
2003-09-26
2003-09-29
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-08-20
2003-09-29
2003-08-08
2003-09-18
2003-09-18
2003-08-18
2003-08-18
2003-08-20
2003-09-16
2003-08-20
2003-08-20
2003-09-16
2003-09-16
2001-09-20
2001-09-20
2003-08-12
2002-09-27
2003-08-18
2002-10-08
2002-10-08
2003-09-04
2003-09-04
2003-09-04
2003-08-13
2003-09-04
2003-08-20
2003-09-04
2003-09-04
2003-09-10
2003-09-10
2000-08-31
2000-09-22
2000-10-04
2000-09-22
2000-08-31
2000-09-29
2001-08-27
2003-09-23
2003-07-05
2000-08-18
2002-08-21
2000-09-20
2000-09-04
2000-08-17
2003-08-20
2003-08-20
2003-08-20
2003-10-01
2002-09-26
2002-10-08
2002-10-08
2003-08-20
2003-09-03
2003-09-03
2002-10-08
2002-10-08
2002-10-08
2002-10-09
2002-10-09
2002-10-09
2002-10-09
2002-10-08
2002-10-09
2002-10-08
2002-10-08
2002-10-09
2002-10-08
2002-10-09
2002-10-08
2002-10-08
2002-10-08
2002-10-08
2003-10-04
2003-08-15
2003-09-18
2003-09-23
2003-09-23
2003-09-23
2003-09-05
2003-09-05
2003-09-05
2003-09-05
2003-09-05
2003-09-05
2003-09-05
2003-09-05
2002-08-30
2003-08-26
2003-09-18
2003-09-18
2003-09-18
2000-09-13
2000-09-13
2000-09-13
2000-09-13
2003-09-12
2003-09-19
2003-09-19
2003-08-25
2003-09-11
2003-09-25
2000-09-13
2003-09-08
2003-09-08
2000-09-04
2003-09-22
2000-08-18
2003-08-20
2003-09-14
2003-09-25
2003-09-18
2002-09-23
2002-09-23
2002-09-23
2002-09-23
2002-09-23
2003-08-19
2003-08-19
2003-08-19
2003-08-19
2002-10-09
2003-09-01
2002-09-23
2002-09-23
2002-09-23
2002-09-23
2002-09-23
2002-09-23
2003-09-05
2003-09-04
2003-09-04
2002-08-28
2003-08-22
2003-09-01
2003-09-01
2003-09-01
2003-09-01
2003-09-01
2003-09-01
2003-09-01
2003-09-01
2000-09-22
2000-09-27
2000-09-13
2003-09-12
2003-08-22
2002-09-03
2003-09-02
2000-10-04
2003-09-22
2003-09-24
2003-09-24
2003-09-08
2000-10-04
2003-09-24
2001-09-17
2001-09-17
2001-09-17
2002-08-30
2002-08-30
2002-09-03
2003-08-15
2002-10-10
2002-10-10
2000-08-31
2000-08-31
2002-08-15
2001-09-10
2001-09-05
2001-09-05
2001-09-14
2001-09-05
2001-09-05
2003-09-25
2003-09-25
2003-09-25
2003-09-25
2003-09-25
2003-09-25
2000-09-13
2000-08-31
2000-08-31
2000-08-31
2000-08-31
2002-10-10
2001-09-17
2001-09-17
2001-08-27
2002-09-26
2002-09-26
2002-09-26
2002-09-26
2000-09-07
2000-09-07
2001-08-23
2002-10-01
2002-10-01
2002-10-01
2002-10-01
2002-10-01
2002-10-01
2002-09-30
2001-08-28
2001-08-28
2001-08-28
2001-08-28
2001-08-28
2001-08-28
2001-09-11
2000-09-20
2003-08-18
2003-09-02
2003-09-18
2003-09-18
2003-09-08
2003-09-02
2003-09-02
2003-09-02
2002-10-01
2003-10-05
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2001-09-18
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2003-09-11
2001-08-24
2001-08-24
2001-08-24
2001-08-24
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-19
2003-09-08
2003-09-08
2003-09-11
2003-09-11
2003-09-24
2003-09-24
2003-09-24
2003-09-24
2000-08-17
2003-09-24
2003-09-24
2003-09-24
2003-09-24
2003-09-24
2003-09-24
2003-09-15
2003-09-15
2003-09-15
2002-09-27
2002-09-10
2002-09-10
2002-08-26
2002-09-26
2002-09-26
2002-08-28
2002-08-28
2002-09-26
2002-09-26
2002-09-26
2002-09-20
2001-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-27
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-10
2002-09-27
2002-09-30
2002-09-30
2002-09-30
2002-09-30
2002-09-30
2002-09-10
2002-09-10





















1995-09-04
1995-09-04
1995-09-04
1995-09-26
1995-09-04
1995-08-14
1978-10-20
1951-09-22
1978-10-20
1978-09-02
1978-10-20
1978-10-20
1935-09-14
1978-10-20
1978-10-20
1978-10-20
1978-10-20
1978-10-20
1978-10-20
1962-09-05
1978-10-20
1978-10-20
1957-08-29
1956-09-19
1957-08-29
1955-09-23
1954-09-07
1954-09-07
1969-08-20
`;

    // ==========================
    // Build phenology on page load
    // ==========================
    document.addEventListener("DOMContentLoaded", () => {
        generatePhenology(melissodesDates, otherDates);
    });

    function generatePhenology(dates1, dates2) {
        const parseDates = (dateText) =>
            dateText.trim().split("\n").map(d => d.trim()).filter(Boolean);

        const countMonths = (dates) => {
            const monthCounts = new Array(12).fill(0);
            for (const date of dates) {
                const parts = date.split("-");
                if (parts.length < 2) continue;
                const month = parseInt(parts[1]);
                if (!isNaN(month) && month >= 1 && month <= 12) monthCounts[month - 1]++;
            }
            return monthCounts;
        };

        const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
        const monthCounts1 = countMonths(parseDates(dates1));
        const monthCounts2 = countMonths(parseDates(dates2));

        const canvas = document.getElementById("bimatrisChart");
        if (!canvas) {
            console.error("Canvas #bimatrisChart not found.");
            return;
        }

        let phenologyChart = null;

        const buildChart = () => {
            const parentWidth = canvas.parentElement.offsetWidth;
            const scaleFactor = parentWidth < 365 ? parentWidth / 365 : 1;

            if (phenologyChart) phenologyChart.destroy();

            phenologyChart = new Chart(canvas, {
                type: "line",
                data: {
                    labels: monthNames,
                    datasets: [
                        {
                            label: "M. bimatris in Oregon",
                            data: monthCounts1,
                            borderColor: "rgba(51, 102, 255, 0.9)",
                            borderWidth: 2 * scaleFactor,
                            tension: 0,
                            pointRadius: 5 * scaleFactor,
                            pointBackgroundColor: "rgba(102, 153, 255, 0.8)",
                            pointBorderColor: "rgba(51, 102, 255, 0.9)",
                            pointHoverRadius: 5 * scaleFactor,
                            pointHoverBorderWidth: 0,
                            pointHoverBackgroundColor: "rgba(51, 102, 255, 0.9)",
                            hitRadius: 0,
                            pointStyle: "circle"
                        },
                        {
                            label: "M. bimatris in and outside Oregon",
                            data: monthCounts2,
                            borderColor: "rgba(255, 0, 0, 0.9)",
                            borderWidth: 2 * scaleFactor,
                            tension: 0,
                            pointRadius: 5 * scaleFactor,
                            pointBackgroundColor: "rgba(255, 102, 102, 0.8)",
                            pointBorderColor: "rgba(255, 0, 0, 0.9)",
                            pointHoverRadius: 5 * scaleFactor,
                            pointHoverBorderWidth: 0,
                            pointHoverBackgroundColor: "rgba(255, 0, 0, 0.9)",
                            hitRadius: 0,
                            pointStyle: "circle"
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    transitions: {
                        active: { animation: { duration: 0 } },
                        resize: { animation: { duration: 0 } }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: "top",
                            labels: {
                                font: { size: 12 * scaleFactor },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            displayColors: false,
                            backgroundColor: "#333",
                            titleColor: "#fff",
                            bodyColor: "#fff",
                            callbacks: {
                                label: ctx => `${ctx.raw} observations`
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                autoSkip: false,
                                font: { size: 12 * scaleFactor }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: { size: 12 * scaleFactor }
                            }
                        }
                    }
                }
            });
        };

        // Initial draw
        buildChart();

        // Redraw on resize
        let resizeTimeout;
        window.addEventListener("resize", () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(buildChart, 150);
        });
    }

})();
