<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bee Nest 3D Viewer</title>
    <style>
      body { margin: 0; overflow: hidden; background: #f4f4f4; }
      #resetButton {
        position: absolute;
        top: 20px;
        left: 20px;
        padding: 8px 16px;
        font-size: 16px;
        background-color: #222;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        opacity: 0.8;
      }
      #resetButton:hover { opacity: 1; }
      .label {
        position: absolute;
        color: #111;
        background: rgba(255,255,255,0.85);
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 13px;
        white-space: nowrap;
        pointer-events: none;
        transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <button id="resetButton">Reset View</button>
    <div id="container"></div>

    <!-- Load Three.js + controls + loaders -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

    <script>
      let scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf4f4f4);

      let camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 2, 5);

      let renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Lighting
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(2, 4, 5);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x999999));

      // Controls
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // Load the model
      const loader = new THREE.GLTFLoader();
      loader.load('nest.glb', (gltf) => {
        const model = gltf.scene;
        model.scale.set(1, 1, 1);
        scene.add(model);

        // Example labeled points (replace with your own coordinates)
        const labeledPoints = [
          { name: 'Cell 1', position: new THREE.Vector3(0.2, 0.1, 0.3) },
          { name: 'Cell 2', position: new THREE.Vector3(-0.3, 0.15, -0.2) },
          { name: 'Cell 3', position: new THREE.Vector3(0.1, -0.1, -0.3) }
        ];

        const labels = labeledPoints.map(p => {
          const div = document.createElement('div');
          div.className = 'label';
          div.textContent = p.name;
          document.body.appendChild(div);
          return { element: div, position: p.position };
        });

        function updateLabels() {
          labels.forEach(l => {
            const vector = l.position.clone();
            vector.project(camera);
            const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
            l.element.style.left = `${x}px`;
            l.element.style.top = `${y}px`;

            // Hide if behind camera
            l.element.style.display = vector.z < 1 ? 'block' : 'none';
          });
        }

        function animate() {
          requestAnimationFrame(animate);
          controls.update();
          renderer.render(scene, camera);
          updateLabels();
        }
        animate();
      });

      // Reset button
      document.getElementById('resetButton').addEventListener('click', () => {
        controls.reset();
      });

      // Handle resizing
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
